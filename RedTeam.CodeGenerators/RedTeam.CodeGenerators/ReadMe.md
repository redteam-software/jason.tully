# RedTeam.Extensions.CodeGenerators

Implementation of a code generator that creates the following:

1.  The boilerplate code for registering KafkaFlow.
 ```
  services.AddKafkaFlowHostedService(
            kafka => kafka.UseRedTeamDefaults(configuration),
                clients =>
                {
                })
        );
 ```
 2. Consumer/Event Handler registrations
 ```
  clients.AddConsumer(eventSectionOptions.Consumers.ExternalDocumentReceived,
                        middlewares => middlewares.AddJsonHandler<ExternalDocumentReceivedHandler>());
 ```

 3. Producer Registrations
 ```
  clients.AddJsonNoSchemaProducer<ExternalDocumentProcessed>(eventSectionOptions.Producers.ExternalDocumentProcessed);
 ```

 4. An extension method unique to the containing assembly to invoke the generated code.
 ```
 //for example an assembly named 'MyEventHandlers' would generate an extension method on IServiceCollection titled, 'AddRedTeamKafkaFlowCodeGeneratorForMyEventHandlers'

 builder.Services.AddRedTeamKafkaFlowCodeGeneratorForMyEventHandlers(builder.Configuration);

 ```

 ## Example Consumer
 ``` csharp
 [AddJsonHandler<EventSectionOptions>(ConfigurationSectionName = nameof(EventSectionOptions.Consumers.TestEvent1))]
public class TestEventHandler1 : RedTeam.Extensions.Consumers.RedTeamMessageHandler<TestEvent1>
{
    public override IDictionary<string, object?> GetMessageLogContext(TestEvent1 message) => new Dictionary<string, object?>();
    public override async Task HandleMessage(IMessageContext context, TestEvent1 message)
    {

    }
}
 ```

 ## Example Producer
 ``` csharp
 [AddJsonNoSchemaProducer<EventSectionOptions>(ConfigurationSectionName = nameof(EventSectionOptions.Producers.TestEvent1))]
public class DocumentProducer : TypedMessageProducer<string, TestEvent1>
{
    public DocumentProducer(IMessageProducer producer) : base(producer)
    {
    }
}
 ```


 ## Example Generated Code From WorkerExample

 ``` csharp
 // <auto-generated />
#nullable enable

using KafkaFlow;
using RedTeam.Extensions.Consumers;
namespace RedTeam.Extensions.Configuration;
/// <summary>
/// Extension methods for configuring Kafka Flow.
/// </summary>
public static class GeneratedKafkaFlowConfigurationExtensions
{
    /// <summary>
    /// Adds  KafkaFlow  from RedTeam.Extensions.CodeGenerators.WorkerExample.
    /// </summary>
    /// <param name="services">Service registrations</param>
    /// <param name="configuration">Configuration</param>
    /// <returns>services</returns>
    [global::System.CodeDom.Compiler.GeneratedCodeAttribute("RedTeam.Extensions.CodeGenerators", "1.0.0+8416e1ec94d47a3c2f363357838687a06659a160")]
    public static global::Microsoft.Extensions.DependencyInjection.IServiceCollection AddRedTeamKafkaFlowCodeGeneratorsWorkerExample(this global::Microsoft.Extensions.DependencyInjection.IServiceCollection services, global::Microsoft.Extensions.Configuration.IConfiguration configuration)
    {
        var eventSectionOptions = configuration.GetSection("Events").Get<global::RedTeam.Extensions.CodeGenerators.WorkerExample.Configuration.EventSectionOptions>()!;
        services.AddKafkaFlowHostedService(kafka => kafka.UseRedTeamDefaults(eventSectionOptions,
            clients => {
                    clients.AddConsumer(eventSectionOptions.Consumers.TestEvent1,middlewares => middlewares.AddJsonHandler<global::RedTeam.Extensions.CodeGenerators.WorkerExample.Consumers.TestEventHandler1>());
                    clients.AddConsumer(eventSectionOptions.Consumers.TestEvent2,middlewares => middlewares.AddJsonHandler<global::RedTeam.Extensions.CodeGenerators.WorkerExample.Consumers.TestEventHandler2>());
                    clients.AddConsumer(eventSectionOptions.Consumers.TestEvent2,middlewares => middlewares.AddProtobufHandler<global::RedTeam.Extensions.CodeGenerators.WorkerExample.Consumers.TestProtobufHandler>());
                    clients.AddJsonNoSchemaProducer<global::RedTeam.Extensions.CodeGenerators.WorkerExample.Producers.DocumentProducer>(eventSectionOptions.Producers.TestEvent1);
                    clients.AddJsonNoSchemaProducer<global::RedTeam.Extensions.CodeGenerators.WorkerExample.Producers.TestProducer2>(eventSectionOptions.Producers.TestEvent2);
            })
            );
    return services;
}
}
 ```